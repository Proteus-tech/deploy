#!/usr/bin/env python
import buildbot
import fabric.network, logging, sys

def main(using_client, *args):
    logging.basicConfig(level=logging.INFO)
    buildbot.restart_master_buildbot(using_client, *args)

if __name__=="__main__":
    msg = """Usage: reset-buildbot-on-server client project_name repository privacy bits region size ami
    client: is profab client
    project_name: name of the project that buildbot run against
    repository: URL to the repository
    privacy: privacy of repository (public|private)
    bits: could be either 32 or 64*
    region: could be us-west-1*, us-west-2 or ap-southeast-1
    size: size of the instance (default is t1.micro)
    ami: is AMI ID (default is ami-4d580408 which is Ubuntu Natty)
    """
    try:
        if len(sys.argv) <= 4:
            print msg
            sys.exit(-1)
        main(*sys.argv[1:])
    finally:
        fabric.network.disconnect_all()

