#!/bin/bash

if [ $# -lt 5 ]; then
    echo "Usage: start-buildbot-svn-slave-build-server client ec2_host ec2_master_host project_name repository"
    echo ""
    echo "client: is profab client"
    echo "ec2_host: public host of EC2 instance"
    echo "<project-name>,<virtenv-name>: project name, virtual environment name"
    exit 1
elif [ $# -eq 5 ]; then
    client=$1
    ec2_host=$2
    ec2_master_host=$3
    project_name=$4
    repository=$5
fi

roles=proteus.www_home

if [ $privacy = "private" ]; then
    echo "do hand shaking for private repository"
    roles="${roles} --proteus.credentials $repository"
fi

deploy_git_url = "git://github.com/Proteus-tech/deploy.git"
bucket_name = "build-pkg-$project_name"
target_tar_file = "/home/www-data/$project_name/current/

roles="${roles} --proteus.buildbot_slave_svn $repository,$ec2_master_host,$project_name"
roles="${roles} --proteus.svn_build_checkout $project_name"
roles="${roles} --proteus.create_build_package_svn $deploy_git_url,$repository"

pf-server-start $client \
                --security_group ssh \
                --security_group \
                http \
                wsgi \
                --bits $bits \
                --region $region \
                --size $size \
                --ami $ami \
                $roles